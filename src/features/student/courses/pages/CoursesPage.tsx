import React, { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import MainLayout from '../../../../shared/ui/layout/MainLayout';

// è¯¾ç¨‹æ¥å£å®šä¹‰
interface Course {
  id: string;
  title: string;
  description: string;
  level: 'beginner' | 'intermediate' | 'advanced';
  duration: string;
  progress: number;
  instructor: string;
  students: number;
  imageUrl: string;
  updatedAt: string;
}

// æ¨¡æ‹Ÿè¯¾ç¨‹æ•°æ®
const mockCourses: Course[] = [
  {
    id: 'stm32-intro',
    title: 'STM32åŸºç¡€å…¥é—¨',
    description: 'äº†è§£STM32ç³»åˆ—å¾®æ§åˆ¶å™¨çš„æ¶æ„ã€ç‰¹æ€§å’Œåº”ç”¨åœºæ™¯ã€‚æœ¬è¯¾ç¨‹å°†ä»‹ç»STM32ç³»åˆ—çš„æ ¸å¿ƒç‰¹ç‚¹ã€æ€§èƒ½ä¼˜åŠ¿ä»¥åŠä¸å…¶ä»–MCUçš„æ¯”è¾ƒã€‚',
    level: 'beginner',
    duration: '2å°æ—¶',
    progress: 75,
    instructor: 'å¼ æ•™æˆ',
    students: 156,
    imageUrl: '/images/courses/stm32-intro.jpg',
    updatedAt: '2024-12-15'
  },
  {
    id: 'stm32-basics',
    title: 'STM32å¼€å‘åŸºç¡€',
    description: 'æŒæ¡STM32çš„åŸºç¡€å¼€å‘çŸ¥è¯†ï¼ŒåŒ…æ‹¬ç¯å¢ƒæ­å»ºã€æ—¶é’Ÿé…ç½®å’ŒåŸºæœ¬å¤–è®¾ä½¿ç”¨ã€‚',
    level: 'beginner',
    duration: '4å°æ—¶',
    progress: 45,
    instructor: 'æè€å¸ˆ',
    students: 203,
    imageUrl: '/images/courses/stm32-basics.jpg',
    updatedAt: '2024-12-20'
  },
  {
    id: 'gpio-programming',
    title: 'GPIOç¼–ç¨‹ä¸LEDæ§åˆ¶',
    description: 'æ·±å…¥å­¦ä¹ STM32çš„GPIOé…ç½®å’Œæ“ä½œï¼Œé€šè¿‡æ§åˆ¶LEDå®ç°å„ç§GPIOç¼–ç¨‹æŠ€å·§ã€‚',
    level: 'beginner',
    duration: '3å°æ—¶',
    progress: 100,
    instructor: 'ç‹å·¥ç¨‹å¸ˆ',
    students: 178,
    imageUrl: '/images/courses/gpio-led.jpg',
    updatedAt: '2024-01-05'
  },
  {
    id: 'uart-communication',
    title: 'UARTä¸²å£é€šä¿¡',
    description: 'å­¦ä¹ STM32çš„UARTé€šä¿¡åŸç†å’Œç¼–ç¨‹å®ç°ï¼ŒæŒæ¡ä¸²å£æ•°æ®æ”¶å‘æŠ€æœ¯ã€‚',
    level: 'intermediate',
    duration: '3.5å°æ—¶',
    progress: 0,
    instructor: 'é™ˆè€å¸ˆ',
    students: 134,
    imageUrl: '/images/courses/uart.jpg',
    updatedAt: '2024-01-10'
  },
  {
    id: 'timer-pwm',
    title: 'å®šæ—¶å™¨ä¸PWMæ§åˆ¶',
    description: 'æ·±å…¥ç†è§£STM32å®šæ—¶å™¨å·¥ä½œåŸç†ï¼Œå­¦ä¹ PWMä¿¡å·ç”Ÿæˆå’Œåº”ç”¨ã€‚',
    level: 'intermediate',
    duration: '4å°æ—¶',
    progress: 0,
    instructor: 'åˆ˜æ•™æˆ',
    students: 98,
    imageUrl: '/images/courses/timer-pwm.jpg',
    updatedAt: '2024-01-15'
  }
];

// è¯¾ç¨‹å¡ç‰‡ç»„ä»¶
const CourseCard: React.FC<{ course: Course }> = ({ course }) => {
  const getLevelColor = (level: string) => {
    switch (level) {
      case 'beginner': return 'bg-green-100 text-green-800';
      case 'intermediate': return 'bg-yellow-100 text-yellow-800';
      case 'advanced': return 'bg-red-100 text-red-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const getLevelText = (level: string) => {
    switch (level) {
      case 'beginner': return 'å…¥é—¨çº§';
      case 'intermediate': return 'ä¸­çº§';
      case 'advanced': return 'é«˜çº§';
      default: return 'æœªçŸ¥';
    }
  };

  return (
    <Link
      to={`/student/courses/${course.id}`}
      className="block bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow overflow-hidden"
    >
      {/* è¯¾ç¨‹å›¾ç‰‡ */}
      <div className="relative h-48 bg-gradient-to-br from-blue-500 to-purple-600">
        <div className="absolute inset-0 flex items-center justify-center">
          <span className="text-white text-4xl">ğŸ“š</span>
        </div>
        {course.progress > 0 && (
          <div className="absolute bottom-0 left-0 right-0 bg-gray-200 h-1">
            <div
              className="bg-blue-500 h-1 transition-all duration-300"
              style={{ width: `${course.progress}%` }}
            />
          </div>
        )}
      </div>

      {/* è¯¾ç¨‹ä¿¡æ¯ */}
      <div className="p-4">
        <div className="flex items-center justify-between mb-2">
          <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getLevelColor(course.level)}`}>
            {getLevelText(course.level)}
          </span>
          {course.progress === 100 && (
            <span className="text-green-600 text-sm font-medium">âœ… å·²å®Œæˆ</span>
          )}
        </div>

        <h3 className="text-lg font-semibold text-gray-900 mb-2">{course.title}</h3>
        <p className="text-gray-600 text-sm mb-4 line-clamp-2">{course.description}</p>

        <div className="flex items-center justify-between text-sm text-gray-500">
          <div className="flex items-center space-x-4">
            <span>ğŸ‘¨â€ğŸ« {course.instructor}</span>
            <span>â±ï¸ {course.duration}</span>
          </div>
          <span>ğŸ‘¥ {course.students}</span>
        </div>

        {course.progress > 0 && course.progress < 100 && (
          <div className="mt-3">
            <div className="flex justify-between text-sm text-gray-600 mb-1">
              <span>å­¦ä¹ è¿›åº¦</span>
              <span>{course.progress}%</span>
            </div>
            <div className="w-full bg-gray-200 rounded-full h-2">
              <div
                className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                style={{ width: `${course.progress}%` }}
              />
            </div>
          </div>
        )}
      </div>
    </Link>
  );
};

/**
 * CoursesPage - å­¦ç”Ÿè¯¾ç¨‹é¡µé¢
 * 
 * æ˜¾ç¤ºå­¦ç”Ÿå¯å­¦ä¹ çš„è¯¾ç¨‹åˆ—è¡¨ï¼Œæ”¯æŒæœç´¢å’Œç­›é€‰
 * å‚è€ƒrefç›®å½•å®ç°ï¼Œç®€åŒ–å¤æ‚åŠŸèƒ½
 */
const CoursesPage: React.FC = () => {
  const [courses, setCourses] = useState<Course[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedLevel, setSelectedLevel] = useState<string>('all');

  // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
  useEffect(() => {
    const loadCourses = async () => {
      // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
      await new Promise(resolve => setTimeout(resolve, 1000));
      setCourses(mockCourses);
      setLoading(false);
    };

    loadCourses();
  }, []);

  // è¿‡æ»¤è¯¾ç¨‹
  const filteredCourses = courses.filter(course => {
    const matchesSearch = course.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         course.description.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesLevel = selectedLevel === 'all' || course.level === selectedLevel;
    return matchesSearch && matchesLevel;
  });

  // ç»Ÿè®¡æ•°æ®
  const stats = {
    total: courses.length,
    completed: courses.filter(c => c.progress === 100).length,
    inProgress: courses.filter(c => c.progress > 0 && c.progress < 100).length,
    notStarted: courses.filter(c => c.progress === 0).length
  };

  return (
    <MainLayout>
        {/* é¡µé¢æ ‡é¢˜ */}
        <div className="mb-8">
          <h1 className="text-2xl font-bold text-gray-900 mb-2">è¯¾ç¨‹å­¦ä¹ </h1>
          <p className="text-gray-600">å­¦ä¹ STM32åµŒå…¥å¼å¼€å‘çš„æ ¸å¿ƒçŸ¥è¯†å’Œå®è·µæŠ€èƒ½</p>
        </div>

        {/* å­¦ä¹ ç»Ÿè®¡ */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div className="card text-center">
            <div className="text-2xl font-bold text-blue-600">{stats.total}</div>
            <div className="text-sm text-gray-600">æ€»è¯¾ç¨‹æ•°</div>
          </div>
          <div className="card text-center">
            <div className="text-2xl font-bold text-green-600">{stats.completed}</div>
            <div className="text-sm text-gray-600">å·²å®Œæˆ</div>
          </div>
          <div className="card text-center">
            <div className="text-2xl font-bold text-yellow-600">{stats.inProgress}</div>
            <div className="text-sm text-gray-600">å­¦ä¹ ä¸­</div>
          </div>
          <div className="card text-center">
            <div className="text-2xl font-bold text-gray-600">{stats.notStarted}</div>
            <div className="text-sm text-gray-600">æœªå¼€å§‹</div>
          </div>
        </div>

        {/* æœç´¢å’Œç­›é€‰ */}
        <div className="card mb-8">
          <div className="flex flex-col md:flex-row gap-4">
            <div className="flex-1">
              <label className="block text-sm font-medium text-gray-700 mb-1">
                æœç´¢è¯¾ç¨‹
              </label>
              <input
                type="text"
                className="input-primary"
                placeholder="è¾“å…¥è¯¾ç¨‹åç§°æˆ–å…³é”®è¯..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
              />
            </div>
            <div className="w-full md:w-48">
              <label className="block text-sm font-medium text-gray-700 mb-1">
                éš¾åº¦ç­‰çº§
              </label>
              <select
                className="input-primary"
                value={selectedLevel}
                onChange={(e) => setSelectedLevel(e.target.value)}
              >
                <option value="all">å…¨éƒ¨ç­‰çº§</option>
                <option value="beginner">å…¥é—¨çº§</option>
                <option value="intermediate">ä¸­çº§</option>
                <option value="advanced">é«˜çº§</option>
              </select>
            </div>
          </div>
        </div>

        {/* è¯¾ç¨‹åˆ—è¡¨ */}
        {loading ? (
          <div className="flex items-center justify-center py-12">
            <div className="loading-spinner h-8 w-8 mr-3"></div>
            <span className="text-gray-600">åŠ è½½è¯¾ç¨‹ä¸­...</span>
          </div>
        ) : filteredCourses.length > 0 ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredCourses.map((course) => (
              <CourseCard key={course.id} course={course} />
            ))}
          </div>
        ) : (
          <div className="text-center py-12">
            <div className="text-6xl mb-4">ğŸ“š</div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è¯¾ç¨‹</h3>
            <p className="text-gray-600 mb-4">è¯·å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰é€‰é¡¹</p>
            <button
              onClick={() => {
                setSearchTerm('');
                setSelectedLevel('all');
              }}
              className="btn-primary"
            >
              é‡ç½®ç­›é€‰
            </button>
          </div>
        )}
    </MainLayout>
  );
};

export default CoursesPage;
